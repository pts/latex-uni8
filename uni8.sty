% by pts@fazekas.hu at Fri Jan 11 15:48:05 CET 2019
%
% It mandates UTF-8 input encoding and T1 font encoding.
% It works with pdflatex and lualatex.
% It works with hyperref.sty.
% It works with color.sty and xcolor.sty.
% It defines \ul for underlining text.
% It selects the default fonts with [font=...] options.
\ProvidesPackage{uni8}[2019/01/02 v0.02 Universal LaTeX inputenc and fontenc]

% Extra customization from .tex: \PassOptionsToPackage{hungarian}{babel}
%
\def\@univ@font{cm}
\def\@univ@inputenc{utf8}\def\@univ@inputenc@isutfe{1}
\DeclareOption{inputenc=utf8}{\def\@univ@inputenc{utf8}\def\@univ@inputenc@isutfe{1}}
\DeclareOption{inputenc=utf8x}{\def\@univ@inputenc{utf8x}\def\@univ@inputenc@isutfe{1}}
\DeclareOption{inputenc=latin1}{\def\@univ@inputenc{latin1}\def\@univ@inputenc@isutfe{0}}
\DeclareOption{inputenc=latin2}{\def\@univ@inputenc{latin2}\def\@univ@inputenc@isutfe{0}}
\DeclareOption{font=cm}{\def\@univ@font{cm}}  % Preferred.
\DeclareOption{font=lm}{\def\@univ@font{cm}}
\DeclareOption{font=ec}{\def\@univ@font{cm}}
\DeclareOption{font=lmodern}{\def\@univ@font{cm}}
\DeclareOption{font=tg}{\def\@univ@font{tg}}
\DeclareOption{font=times}{\def\@univ@font{tg}}  % Preferred.
\DeclareOption{font=old-times}{\def\@univ@font{oldtimes}}  % Preferred.
\DeclareOption{font=oldtimes}{\def\@univ@font{oldtimes}}
\DeclareOption{nop}{}
\ProcessOptions\relax

\ifx\luatexversion\@undefined
  % luainputenc would also work, but we don't want to depend on it, to
  % remain compatible with earlier versions of pdflatex.
  \expandafter\RequirePackage\expandafter[\@univ@inputenc]{inputenc}
\else
  % Needed for ő and ű in non-fontspec fonts.
  \expandafter\RequirePackage\expandafter[\@univ@inputenc]{luainputenc}
\fi
\def\encodingdefault{T1}  % Part of t1enc.sty
\fontencoding{T1}  % Part of t1enc.sty.
% We don't run \selectfont here (t1enc.sty does), to avoid loading
% ecrm1000.tfm here when it is not available (e.g. no
% sudo apt-get install texlive-fonts-recommended).

% TODO(pts): Add [font=tnr] for Times New Roman, Helvetica, Courier New.
% TODO(pts): Add [fontspec] option for all fonts (cm, tg, tnr, old-times), only used in lualatex.
\def\@univ@font@cm{%  Latin Modern fonts, bettern than CM and EC for international text in T1 encoding.
  \RequirePackage{lmodern}
}
\def\@univ@font@tg{% TeX Gyre fonts, great alternative for Times, Helvetica and Courier.
  % Also changes math fonts. Load before tgtermes so that tgtermes can
  % change text fonts back.
  %
  % TODO(pts): Better with newtxtext and newtxmath?
  % https://tex.stackexchange.com/q/469726/820
  \RequirePackage{mathptmx}
  \RequirePackage{tgtermes}
  \RequirePackage{tgheros}
  \RequirePackage{tgcursor}
}
\def\@univ@font@oldtimes{% Times, Helvetica and Courier.
  % Ugly spacing of the accent in \H{o}. Use [font=tg] instead.
  %
  % Doesn't affect math fonts.
  %\RequirePackage{times}
  % Also changes math fonts.
  \RequirePackage{mathptmx}
  % TODO(pts): Check txfonts.sty aand https://ctan.org/pkg/newtx as well.
  % TODO(pts): With fontspec, use https://ctan.org/pkg/tex-gyre-math?lang=en with
  %            unicode-math.
}
\csname @univ@font@\@univ@font\endcsname

% Without this lualatex wouldn't consider the characters ő and ű in font
% encoding T1 as letters during hyphenation.
%
% This magic is based on https://tex.stackexchange.com/a/469909/820
\@tempcnta128 \loop\ifnum\@tempcnta<159 \ifnum\lccode\@tempcnta=0
  \lccode\@tempcnta\@tempcnta\fi \advance\@tempcnta1 \repeat
\@tempcnta160 \loop\ifnum\@tempcnta<190 \ifnum\lccode\@tempcnta=0
  \lccode\@tempcnta\@tempcnta\fi \advance\@tempcnta1 \repeat
\@tempcnta192 \loop\ifnum\@tempcnta<256 \ifnum\lccode\@tempcnta=0
  \lccode\@tempcnta\@tempcnta\fi \advance\@tempcnta1 \repeat

% Make loadhyph-hu.tex loaded by babel.sty in TeX Live 2019 load
% hyph-hu.ec.tex rather than hyph-hu.tex in lualatex.
%
% This magic is based on https://tex.stackexchange.com/a/469909/820
\let\kanjiskip\hsize
% Without this, hyphenation \language macros such as \l@english and
% \l@hungarian wouldn't be defined in lualatex.
%\edef\reserved@a{\csname opt@babel.sty\endcsname}
\expandafter\ifx\csname opt@babel.sty\endcsname\relax
  % english is the default language (including default hyphenation) if
  % \PassOptionsToPackage{...}{babel} was not specified.
  \expandafter\def\csname opt@babel.sty\endcsname{english}\fi
\RequirePackage{babel}
\let\kanjkiskip\@undefined  % Undo our hack above.
% Override magyar.ldf to prevent warning about \usepackage[...]{inputenc}.
\def\magyar@sugg@ie#1{}

\edef\reserved@a{\csname inputencodingname\endcsname}
\edef\reserved@b{utf8}
\ifx\reserved@a\reserved@b
  \def\@univ@inputenc@isutfe{1}
\else
  \edef\reserved@b{utf8x}
  \ifx\reserved@a\reserved@b
    \def\@univ@inputenc@isutfe{1}
  \fi
\fi

\if1\@univ@inputenc@isutfe
  \IfFileExists{soulutf8.sty}{\IfFileExists{soul.sty}{
    % For non-utf8 input encodings, use \usepackage{soul}.
    \RequirePackage{soulutf8}
    \def\underline{\ul}  % \underline is built-in. Let's use soul's.
    \def\uline{\ul}  % \uline is from ulem. Let's use soul's.
  }{}}{}
\else
  \IfFileExists{soul.sty}{
    \usepackage{soul}
    \def\underline{\ul}  % \underline is built-in. Let's use soul's.
    \def\uline{\ul}  % \uline is from ulem. Let's use soul's.
  }{}
\fi

\endinput
